(()=>{"use strict";var e=function(e,t){for(var n=0,r=t.length,i=e.length;n<r;n++,i++)e[i]=t[n];return e},t=function(){function t(e){this.entriesIndex=0,this.requestIndex=0,this.settings=e,this.errors=[],window.addEventListener("beforeunload",this.onBeforeUpload.bind(this)),window.addEventListener("error",this.onWindowError.bind(this)),this.addSendingToQuery()}return t.prototype.sendDataToServerByTimer=function(){var e=this.getData();if(null!==e){var t=this.sendData(e,!1);(t=t.catch((function(e){return console.error(e)}))).finally(this.addSendingToQuery.bind(this))}else this.addSendingToQuery()},t.prototype.addSendingToQuery=function(){window.setTimeout(this.sendDataToServerByTimer.bind(this),5e3)},t.prototype.onWindowError=function(e){this.errors.push({colNo:e.colno,filename:e.filename,lineNo:e.lineno,msg:e.message,time:e.timeStamp})},t.prototype.getData=function(){var t=this.entriesIndex,n=window.performance?window.performance.getEntries():[];this.entriesIndex=n.length;var r=n.slice(t).filter(this.resourceFilter.bind(this));if(!(r.length>0||this.errors.length>0))return null;var i={custom:this.settings.staticData,data:r,errors:e([],this.errors),localtime:(new Date).toISOString(),timezone:Intl?Intl.DateTimeFormat().resolvedOptions().timeZone:"",ua:navigator.userAgent,requestIndex:this.requestIndex};return this.errors.length=0,this.requestIndex+=1,i},t.prototype.resourceFilter=function(e){return!this.settings.exceptRuleRegexp.test(e.name)},t.prototype.sendDataAsXMLHttpRequest=function(e,t){var n=this;return void 0===t&&(t=!0),new Promise((function(r,i){var o=new XMLHttpRequest;o.open("POST",n.settings.url,t),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.onload=function(){200===o.status?r():i("error-status-code")},o.onerror=function(){return i("error-while-request")},o.send(JSON.stringify(e))}))},t.prototype.sendDataWithBeacon=function(e){return navigator.sendBeacon(this.settings.url,JSON.stringify(e))?Promise.resolve():Promise.reject("some-error")},t.prototype.sendData=function(e,t){return void 0===t&&(t=!0),void 0!==navigator.sendBeacon?this.sendDataWithBeacon(e):this.sendDataAsXMLHttpRequest(e,t)},t.prototype.onBeforeUpload=function(){var e=this.getData();null!==e&&this.sendData(e,!1).catch((function(e){return console.error(e)}))},t}();window.timeMonitoring=window.timeMonitoring||{staticData:{account_id:1,session_id:"session-test",user_id:1},exceptRuleRegexp:/v02.getcourse.ru\/monitoring/,url:"https://v02.getcourse.ru/monitoring/save"},window.TimeMonitoring=new t(window.timeMonitoring)})();